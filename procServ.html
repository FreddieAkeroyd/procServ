<?xml version="1.0" encoding="us-ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=us-ascii" />
  <title>procServ Documentation</title>
  <meta name="generator" content="Amaya 9.54, see http://www.w3.org/Amaya/" />
</head>

<body>
<h1>procServ - Process Server with Telnet Console and Log Access</h1>

<h4>SYNOPSIS</h4>

<p><code><strong>procServ</strong> [<strong>--autorestartcmd</strong> char]
[<strong>--coresize</strong> size]
[<strong>-d</strong>|<strong>--debug</strong>]
[<strong>-h</strong>|<strong>--help</strong>] [<strong>--restrict</strong>]
[<strong>-i</strong>|<strong>--ignore</strong> chars]
[<strong>-k</strong>|<strong>--killchar</strong> char]
[<strong>--killsig</strong> signal]
[<strong>-l</strong>|<strong>--logport</strong> port]
[<strong>-L</strong>|<strong>--logfile</strong> file]
[<strong>-n</strong>|<strong>--name</strong> title]
[<strong>--noautorestart</strong>]
[<strong>-p</strong>|<strong>--pidfile</strong> file] port command args
...</code></p>

<h4>DESCRIPTION</h4>

<p><strong>procServ</strong> creates a run time environment for a command
(e.g. a <strong>soft IOC</strong>). It forks a server run as a daemon into
the background, which creates a <strong>child process</strong> running
<code>command</code> with all remaining <code>args</code> from the command
line. The server provides <strong>console access</strong> (stdin/stdout) to
the child process by offering a telnet connection at the specified
<code>port</code>. For security reasons, access is restricted to connections
from localhost (127.0.0.1), so that logging into a valid account on the host
machine is required.</p>

<p><strong>procServ</strong> can be configured to write a <strong>console
<strong>log</strong></strong> of all in- and output of the child process into
a file using the <code>-L</code> (<code>--logfile</code>) option. To
facilitate running under a central console access management (like
<strong>conserver</strong>), the <code>-l</code> (<code>--logport</code>)
option creates an additional telnet port, which is by default public (i.e.
not restricted to localhost), and provides read-only <strong>log
access</strong> to the child's console. The <code>-r</code>
(<code>--restrict</code>) option restricts the log port to localhost, similar
to the access port.</p>

<p>Both access and log ports allow <strong>multiple connections</strong>,
which are handled transparently: all input from access connections is
forwarded to the child process, all output from the child is forwarded to all
access and log connections (and written to the log file). All diagnostic
messages from the server process<strong></strong>start with "<code>@@@</code>
" to be clearly distinguished from child process messages. A name specified
by the <code>-n</code> (<code>--name</code>) option will replace the
<code>command</code> string in many messages for increased readability.</p>

<p>The server will by default automatically <strong>respawn a child</strong>
process when it dies. To avoid spinning, a minimum time between child process
restarts is honoured (default: 15 seconds, can be changed at compile time).
This behaviour can be toggled online using the toggle command
<code>^T</code>, the default may be changed using the
<code>--noautorestart</code> option. You can <strong>restart a running child
manually</strong> by sending a signal to the child process using the kill
command <code>^X</code>.<br />
With the child process being shut down, the server accepts two commands:
<code>^R</code> to <strong>restart the child</strong> and <code>^Q</code> to
<strong>quit the server</strong>.</p>

<p>To <strong>block input characters</strong> that are potentially dangerous
to the child (e.g. <code>^D</code> and <code>^C</code> on soft IOCs), the
<code>-i</code> (<code>--ignore</code>) option can be used to specify
characters that are silently ignored when coming from a console access
port.<br />
</p>

<p>To facilitate being started and stopped as a standard system service, the
<code>-p</code> (<code>--pidfile</code>) option tells the server to create a
standard <strong>PID file</strong> containing the PID of the server
process.</p>

<p>The <code>-d</code> (<code>--debug</code>) option runs the server in
<strong>debug mode</strong>: the daemon process stays in the foreground,
printing all regular log content plus additional debug messages to stdout.</p>

<h4>OPTIONS</h4>
<dl>
  <dt><strong><code>--autorestartcmd</code></strong> <code>char</code></dt>
    <dd>Toggle auto restart flag when <code>char</code> is sent on an access
      connection. Use <code>^</code> to specify a control character, "" to
      disable. Default is <code>^T</code>.</dd>
    <dd></dd>
  <dt><code><strong>--coresize</strong> size</code></dt>
    <dd>Set the maximum <code>size</code> of core file. See
      <code>getrlimit</code> documentation for details. Setting
      <code>size</code> to 0 will keep child from creating core files.</dd>
    <dd></dd>
  <dt><strong><code>-d</code></strong> |
  <strong><code>--debug</code></strong></dt>
    <dd>Enter debug mode. Debug mode will keep the server process in the
      foreground and enables diagnostic messages that will be sent to the
      controlling terminal.</dd>
    <dd></dd>
  <dt><strong><code>-h</code></strong> |
  <strong><code>--help</code></strong></dt>
    <dd>Print help message.</dd>
    <dd></dd>
  <dt><strong><code>-i</code></strong> |
  <strong><code>--ignore</code></strong> <code>chars</code></dt>
    <dd>Ignore all characters in <code>chars</code> on access connections.
      This can be used to shield the child process from input characters that
      are potentially dangerous, e.g. <code>^D</code> and <code>^C</code>
      characters that would shut down a soft IOC. Use <code>^</code> to
      specify control characters, <code>^^</code> to specify a single
      <code>^</code> character.</dd>
    <dd></dd>
  <dt><strong><code>-k</code></strong> |
  <strong><code>--killcmd</code></strong> <code>char</code></dt>
    <dd>Kill the child process (child will be restarted automatically by
      default) when <code>char</code> is sent on an access connection. Use
      <code>^</code> to specify a control character, "" for no kill command.
      Default is <code>^X</code>.</dd>
    <dd></dd>
  <dt><code><strong>--killsig</strong> signal</code></dt>
    <dd>Kill the child using <code>signal</code> when receiving the kill
      command. Default is 9 (<code>SIGKILL</code>).</dd>
    <dd></dd>
  <dt><strong><code>-l</code></strong> |
  <strong><code>--logport</code></strong> <code>port</code></dt>
    <dd>Provide read-only access to the child's console on <code>port</code>.
      By default all hosts can connect to <code>port</code>, use the
      <code>-r</code> (<code>--restrict</code>) option to restrict access to
      localhost.</dd>
    <dd></dd>
  <dt><strong><code>-L</code></strong> |
  <strong><code>--logfile</code></strong> <code>file</code></dt>
    <dd>Write a console log of all in- and output to <code>file</code>.</dd>
    <dd></dd>
  <dt><strong><code>-n</code></strong> | <strong><code>--name</code></strong>
  <code>title</code></dt>
    <dd>In all server messages, use <code>name</code> instead of the full
      <code>command</code> line to increase readability.</dd>
    <dd></dd>
  <dt><strong><code>--noautorestart</code></strong></dt>
    <dd>Do not automatically restart child process on exit.</dd>
    <dd></dd>
  <dt><strong><code>-p</code></strong> |
  <strong><code>--pidfile</code></strong> <code>file</code></dt>
    <dd>Write the PID of the server process into <code>file</code> to
      facilitate integration into regular system service administration
      mechanisms.</dd>
    <dd></dd>
  <dt><strong><code>--restrict</code></strong></dt>
    <dd>Restrict log connections to localhost.</dd>
    <dd></dd>
</dl>

<h4>USAGE</h4>

<p>To start a soft IOC using <strong>procServ</strong>, change the directory
into the IOC's boot directory. A typical command line would be</p>
<pre>    <kbd>procServ -n "My SoftIOC" -i ^D^C 20000 ./st.cmd</kbd></pre>

<p>To <strong>connect</strong> to the IOC, log into the soft IOC's host and
connect to port 20000 using</p>
<pre>    <kbd>telnet localhost 20000</kbd></pre>

<p>You will be connected to the soft IOCs console and receive an informative
welcome message. All output from the procServ server will start with
"<code>@@@</code> " to allow telling it apart from messages that your IOC
sends.</p>
<pre>    &gt; <kbd>telnet localhost 20000</kbd><br />    Trying 127.0.0.1...
    Connected to localhost.
    Escape character is '^]'.
    @@@ Welcome to the procServ process server (procServ Version 2.1.0)
    @@@ Use ^X to kill the child, auto restart is ON, use ^T to toggle auto restart
    @@@ procServ server PID: 21413
    @@@ Startup directory: /net/csr/srv/projects/ctl/lange/epics/ioc/test314/iocBoot/iocexample
    @@@ Child "My SoftIOC" started as: ./st.cmd
    @@@ Child "My SoftIOC" PID: 21414
    @@@ procServ server started at: Fri Apr 25 16:43:00 2008
    @@@ Child "My SoftIOC" started at: Fri Apr 25 16:43:00 2008
    @@@ 0 user(s) and 0 logger(s) connected (plus you)</pre>

<p>Type the kill command character <kbd>^X</kbd> to reboot the soft IOC and
get server messages about this action.</p>

<p>Type the telnet escape character <kbd>^]</kbd> to get back to a telnet
prompt and <kbd>quit</kbd> to exit telnet.</p>

<p>While <strong>procServ</strong> was intended to be an environment to run
soft IOCs, any process might be started as child. It provides an environment
for any program that requires access to its console and should be run in the
background as a daemon. By writing a file log directly or through a console
access and logging facility (such as <strong>conserver</strong>), the log of
such a program's output can be used to correlate its messages to other
events.<br />
E.g., in an EPICS environment, running <strong>casw</strong> (the beacon
anomaly watcher) can provide useful log output to analyse and track down
network issues (name resolution broadcast storms).</p>

<h4>KNOWN PROBLEMS</h4>

<p>None so far.</p>

<h4>REPORTING BUGS</h4>

<p>Report bugs to <code>&lt;tech-talk@aps.anl.gov&gt;</code>.</p>

<h4>AUTHORS</h4>

<p>Written by David H. Thompson <code>&lt;thompsondh@ornl.gov&gt;</code> and
Ralph Lange <code>&lt;Ralph.Lange@bessy.de&gt;</code>.</p>

<p></p>
</body>
</html>
